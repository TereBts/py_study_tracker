{% extends "base.html" %}

{% block content %}
  <h1>Your Study Goals</h1>

  <a href="{% url 'goals:create' %}" class="btn btn-primary mb-3">+ Add New Goal</a>

  {% if object_list %}
    <ul class="list-group">
      {% for goal in object_list %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <a href="{% url 'goals:detail' pk=goal.pk %}" class="fw-bold">
              {% if goal.course %}{{ goal.course.title }} – {% endif %}
              {% if goal.milestone_name %}{{ goal.milestone_name }}{% else %}Goal {{ goal.id }}{% endif %}
            </a>
            <small class="text-muted d-block mt-1">
              {% if goal.weekly_hours_target %}
                Weekly: {{ goal.weekly_hours_target }} hrs
              {% endif %}
              {% if goal.weekly_lessons_target %}
                {% if goal.weekly_hours_target %} | {% endif %}
                Lessons: {{ goal.weekly_lessons_target }} / wk
              {% endif %}
              {% if goal.total_required_lessons %}
                {% if goal.weekly_hours_target or goal.weekly_lessons_target %} | {% endif %}
                Milestone: {{ goal.total_required_lessons }} lessons
                {% if goal.milestone_date %}(due {{ goal.milestone_date }}){% endif %}
              {% endif %}
            </small>
          </div>

          <div class="d-flex align-items-center">
            <a href="{% url 'goals:edit' pk=goal.pk %}" class="btn btn-sm btn-outline-secondary me-2">Edit</a>

            <!-- Inline delete form (POST + CSRF) -->
            <form action="{% url 'goals:delete' pk=goal.pk %}" method="post" style="display:inline"
                  onsubmit="return confirm('Are you sure you want to delete this goal?');">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-danger" aria-label="Delete goal {{ goal.id }}">Delete</button>
            </form>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>You haven’t set any goals yet.</p>
  {% endif %}
{% endblock %}
