{% extends "base.html" %}
<!-- ============================================
  Template: goals/goal_list.html
  Description: Displays a list of all study goals created by the user,
               showing their progress and providing edit/delete options.
  Dependencies:
    - Extends base.html for consistent layout and navigation.
    - Context variable: object_list (QuerySet of Goal objects).
  ============================================ -->

{% block content %}
  <!-- ====== PAGE HEADER ======
       Displays the main heading and a button to add a new goal. -->
  <h1>Your Study Goals</h1>

  <a href="{% url 'goals:create' %}" class="btn btn-primary mb-3">+ Add New Goal</a>

  <!-- ====== GOAL LIST ======
       Renders all user goals, or a message if none exist. -->
  {% if object_list %}
    <ul class="list-group">
      {% for goal in object_list %}
        <li class="list-group-item">
          <div class="d-flex justify-content-between align-items-start">
            
            <!-- ====== GOAL DETAILS COLUMN ======
                 Displays course name, milestone, and progress. -->
            <div class="flex-grow-1">
              
              <!--     Goal Title    
                   Links to the goal detail page. -->
              <a href="{% url 'goals:detail' pk=goal.pk %}" class="fw-bold">
                {% if goal.course %}{{ goal.course.title }} â€“ {% endif %}
                {% if goal.milestone_name %}
                  {{ goal.milestone_name }}
                {% else %}
                  Goal {{ goal.id }}
                {% endif %}
              </a>

              <!--     Goal Summary    
                   Shows weekly targets and milestone info in one compact line. -->
              <small class="text-muted d-block mt-1">
                {% if goal.weekly_hours_target %}
                  Weekly: {{ goal.weekly_hours_target }} hrs
                {% endif %}
                {% if goal.weekly_lessons_target %}
                  {% if goal.weekly_hours_target %} | {% endif %}
                  Lessons: {{ goal.weekly_lessons_target }} / wk
                {% endif %}
                {% if goal.total_required_lessons %}
                  {% if goal.weekly_hours_target or goal.weekly_lessons_target %} | {% endif %}
                  Milestone: {{ goal.total_required_lessons }} lessons
                  {% if goal.milestone_date %}(due {{ goal.milestone_date }}){% endif %}
                {% endif %}
              </small>

              <!-- ====== WEEKLY PROGRESS BAR ======
                   Visual representation of progress towards the weekly goal. -->
              {% if goal.weekly_hours_target %}
                {% with weekly=goal.weekly_progress_percent %}
                  <small class="text-muted d-block mt-1">
                    This week: {{ goal.weekly_study_hours }} / {{ goal.weekly_hours_target }} hrs
                  </small>
                  <div class="progress mt-1" style="height: 18px;">
                    <div class="progress-bar
                      {% if weekly >= 100 %}
                        bg-success
                      {% elif weekly >= 50 %}
                        bg-warning text-dark
                      {% else %}
                        bg-danger
                      {% endif %}"
                      role="progressbar"
                      style="width: {{ weekly }}%;"
                      aria-valuenow="{{ weekly }}" aria-valuemin="0" aria-valuemax="100">
                    </div>
                  </div>
                {% endwith %}
              {% endif %}

              <!-- ====== OVERALL PROGRESS BAR ======
                   Shows total milestone progress if applicable. -->
              {% with overall=goal.overall_progress_percent %}
                {% if overall %}
                  <small class="text-muted d-block mt-2">
                    Overall: {{ overall }}% complete toward milestone
                  </small>
                  <div class="progress mt-1" style="height: 18px;">
                    <div class="progress-bar bg-info text-dark"
                      role="progressbar"
                      style="width: {{ overall }}%;"
                      aria-valuenow="{{ overall }}" aria-valuemin="0" aria-valuemax="100">
                    </div>
                  </div>
                {% endif %}
              {% endwith %}

              <!--     Completion Badges     -->
              {% if goal.weekly_progress_percent >= 100 %}
                <small class="text-success fw-semibold d-block mt-2">
                  âœ… Weekly goal complete!
                </small>
              {% endif %}
              {% if goal.overall_progress_percent and goal.overall_progress_percent >= 100 %}
                <small class="text-primary fw-semibold d-block mt-1">
                  ðŸŒŸ Overall milestone achieved!
                </small>
              {% endif %}
            </div>

            <!-- ====== ACTION BUTTONS ======
                 Provides Edit and Delete options for each goal. -->
            <div class="ms-3 text-nowrap">
              <a href="{% url 'goals:edit' pk=goal.pk %}" 
                 class="btn btn-sm btn-outline-secondary me-2">Edit</a>

            <a href="{% url 'goals:delete' pk=goal.pk %}" class="btn btn-sm btn-danger">
              Delete
            </a>
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>

  {% else %}
    <!--     Empty State    
         Displays if the user has no existing goals. -->
    <p>You havenâ€™t set any goals yet.</p>
  {% endif %}
{% endblock %}
