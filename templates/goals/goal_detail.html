{% extends "base.html" %}

{% block content %}
  <h1>Goal Details</h1>

  <p><strong>Course:</strong> {{ goal.course }}</p>
  <p><strong>Weekly Hours Target:</strong> {{ goal.weekly_hours_target }}</p>
  <p><strong>Weekly Lessons Target:</strong> {{ goal.weekly_lessons_target }}</p>
  <p><strong>Study Days Per Week:</strong> {{ goal.study_days_per_week }}</p>

  {% if goal.daily_hours_target %}
    <p><strong>Daily Hours Target:</strong> {{ goal.daily_hours_target|floatformat:2 }}</p>
  {% endif %}
  {% if goal.daily_lessons_target %}
    <p><strong>Daily Lessons Target:</strong> {{ goal.daily_lessons_target|floatformat:2 }}</p>
  {% endif %}

  {% if goal.milestone_name %}
    <hr>
    <p><strong>Milestone:</strong> {{ goal.milestone_name }}
       {% if goal.milestone_date %}(due {{ goal.milestone_date }}){% endif %}</p>
    <p><strong>Total Required Lessons:</strong> {{ goal.total_required_lessons }}</p>
  {% endif %}

  <hr>

  <!-- === Progress Overview === -->
  {% with weekly=goal.weekly_progress_percent overall=goal.overall_progress_percent %}
    <h4>Progress Overview</h4>

    {% if weekly %}
      <p><strong>This week:</strong> {{ goal.weekly_study_hours }} / {{ goal.weekly_hours_target }} hrs</p>
      <div class="progress mb-3" style="height: 22px;">
        <div class="progress-bar
          {% if weekly >= 100 %}
            bg-success
          {% elif weekly >= 50 %}
            bg-warning text-dark
          {% else %}
            bg-danger
          {% endif %}"
          role="progressbar"
          style="width: {{ weekly }}%;"
          aria-valuenow="{{ weekly }}" aria-valuemin="0" aria-valuemax="100">
          Weekly: {{ weekly }}%
        </div>
      </div>
    {% endif %}

    {% if overall %}
      <p><strong>Overall progress:</strong> {{ overall }}% complete toward milestone</p>
      <div class="progress mb-3" style="height: 22px;">
        <div class="progress-bar bg-info text-dark"
          role="progressbar"
          style="width: {{ overall }}%;"
          aria-valuenow="{{ overall }}" aria-valuemin="0" aria-valuemax="100">
          Overall: {{ overall }}%
        </div>
      </div>
    {% endif %}

    {% if weekly >= 100 %}
      <div class="alert alert-success d-flex align-items-center" role="alert">
        <span class="me-2 fs-4">âœ…</span>
        <div><strong>Weekly goal complete!</strong> Great job keeping pace.</div>
      </div>
    {% endif %}
    {% if overall and overall >= 100 %}
      <div class="alert alert-info d-flex align-items-center" role="alert">
        <span class="me-2 fs-4">ðŸŒŸ</span>
        <div><strong>Milestone achieved!</strong> Youâ€™ve completed your overall goal!</div>
      </div>
    {% endif %}
  {% endwith %}

  {% if goal.projected_completion_date %}
  <span class="badge bg-light text-dark">
  ðŸ“… Projected finish: {{ goal.projected_completion_date|date:"j M Y" }}
  </span>
  {% endif %}

  <hr>

  <a href="{% url 'goals:edit' pk=goal.pk %}" class="btn btn-warning">Edit Goal</a>
  <form action="{% url 'goals:delete' pk=goal.pk %}" method="post" style="display:inline"
        onsubmit="return confirm('Delete this goal?');">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">Delete</button>
  </form>
  <a href="{% url 'goals:list' %}" class="btn btn-secondary">Back to Goals</a>
{% endblock %}